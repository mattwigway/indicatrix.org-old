<!DOCTYPE html>
<html>
  <head>
    <title>Accessing GTFS Data in QGIS&mdash;Indicatrix</title>

    <link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css" />
<link rel="stylesheet" href="/css/pygments.css" />
<link rel="stylesheet" href="/css/main.css" />


  </head>
  <body>
    <div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand indicatrix" href="/">Indicatrix</a>
      <ul class="nav">
        <li><a href="/projects">Projects</a></li>
        <li><a href="/copyright">Copyright</a></li>
        <li><a href="/archive">Archive</a></li>
      </ul>
    </div>
  </div>
</div>


    <div class="container">
      <div class="hero-unit">
        <h1><a href="/"><img src="/img/header.jpg" alt="Indicatrix" /></a></h1>
        <div class="vspacer"></div>
        <p>A blog about mapping, Python, GIS, JavaScript, transit, open data,
          planning, &c.</p>
      </div>

      <div class="row">
        <div class="span9">
          
<!-- link it b/c this template is used on the home page -->
<a href="/2011/07/25/accessing-gtfs-data-in-qgis/">
  <h2>Accessing GTFS Data in QGIS</h2>
</a>
<p class="author">by mattwigway on July 25, 2011</p>

<p>When you load GTFS data into PostGIS using <a href="http://code.google.com/p/gtfsdb/">gtfsdb</a>, you can&rsquo;t access that data in QGIS because the tables don&rsquo;t have a primary key in int4 format (the primary key is in text format).</p>

<p>If your transit system uses numeric ids in text format, an easy fix is running this against each of your tables:</p>

<div class="highlight"><pre><code class="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">stops</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">gid</span> <span class="nb">int</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">stops</span> <span class="k">SET</span> <span class="n">gid</span> <span class="o">=</span> <span class="n">stop_id</span><span class="p">::</span><span class="nb">int</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">stops</span> <span class="k">ALTER</span> <span class="k">COLUMN</span> <span class="n">gid</span> <span class="k">SET</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">;</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">stops</span> <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">stops_gid_uniq</span> <span class="k">UNIQUE</span><span class="p">(</span><span class="n">gid</span><span class="p">);</span>
</code></pre>
</div>


<p>What this does is creates an integer ID field, populates it with the stop_id (or shape_id, &amp;c.) cast to an integer, then adds NOT NULL and UNIQUE constraints to the column. You can&rsquo;t add the constraints beforehand, because the column is initialized to NULL values. Remember you have to run these commands against every table you want to pull into QGIS directly, and remember to change stop_id to shape_id &amp;c.</p>

<p>The advantage to this approach is that the gids are the same as the stop_ids. The disadvantage of this approach is that it doesn&rsquo;t work with systems like <a href="http://bart.gov">BART</a> that have alphanumeric stop ids, like &lsquo;SHAY&rsquo; or &lsquo;24TH.&rsquo; If your system has a few ids like &lsquo;3104_A&rsquo;, don&rsquo;t worry that you won&rsquo;t notice them; Postgres won&rsquo;t cast that to a number but will throw an error like:</p>

<pre>
ERROR:  invalid input syntax for integer: "3104_A"
</pre>


<p>At least, that&rsquo;s what it did in Postgres 9.0.4.</p>

<p><strong>Update 2011-11-05:</strong></p>

<p>If your transit system has non-numeric IDs and you can&rsquo;t use the casting trick, you can create numerical IDs that are not tied to the Stop IDs like so:</p>

<div class="highlight"><pre><code class="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="o">&lt;</span><span class="k">table</span><span class="o">&gt;</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">nid</span> <span class="nb">SERIAL</span><span class="p">;</span>
</code></pre>
</div>


<p>Thanks, <a href="http://underdark.wordpress.com">underdark</a>!</p>


<!-- again, b/c it's used on the home page -->
<a href="/2011/07/25/accessing-gtfs-data-in-qgis/">Permalink to this post</a>


<div class="vspacer5"></div>
<h3>Related posts (autogenerated)</h3>
<ul>

  <li><a href="/2012/06/16/migrating-to-jekyll/">Migrating to Jekyll <i>(June 16, 2012)</i></a></li>

  <li><a href="cgs2012">Measuring Urban Mobility and Accessibility Using OpenTripPlanner Analyst <i>(April 29, 2012)</i></a></li>

  <li><a href="/2012/04/01/elevators-in-opentripplanner/">Elevators in OpenTripPlanner <i>(April 01, 2012)</i></a></li>

  <li><a href="/2012/04/01/bart-shocker-first-inner-core-infill-station-since-embarcadero/">BART Shocker: First Inner-Core Infill Station Since Embarcadero <i>(April 01, 2012)</i></a></li>

  <li><a href="/2012/03/31/conditionals-in-the-qgis-raster-calculator/">Conditionals in the QGIS raster calculator <i>(March 31, 2012)</i></a></li>

  <li><a href="/2012/03/03/conditional-labels-in-qgis/">Conditional Labels in QGIS <i>(March 03, 2012)</i></a></li>

  <li><a href="/2012/02/02/more-basemaps-in-qgis/">More Basemaps in QGIS <i>(February 02, 2012)</i></a></li>

  <li><a href="/2011/12/30/transit-to-everywhere/">Transit to Everywhere <i>(December 30, 2011)</i></a></li>

  <li><a href="/2011/12/23/as-you-may-have/">GitHub Image Diffs <i>(December 23, 2011)</i></a></li>

  <li><a href="/2011/12/13/shapefiles-in-openlayers/">Shapefiles in OpenLayers <i>(December 13, 2011)</i></a></li>


        </div>
        <div class="span3">
          <div class="barbox">
  <h3>Other Accounts</h3>
  <ul class="linklist">
    <li><a href="http://github.com/mattwigway">GitHub</a></li>
    <li><a href="http://twitter.com/mattwigway">Twitter</a></li>
  </ul>
</div>

<div class="barbox">
  <h3>Blogroll</h3>
  <ul class="linklist">
    <li>
      <a href="http://www.humantransit.org">Human Transit</a>
    </li>
    <li>
      <a title="Free and Open Source GIS" href="http://underdark.wordpress.com">UnderDark</a>
    </li>
    <li>
      <a href="http://transitappliance.org">Transit Appliance Development</a>
    </li>
    <li>
      <a href="http://portlandtransport.org">Portland Transport</a>
    </li>
    <li>
      <a href="http://thesource.metro.net">The Source&mdash;Los Angeles Metro</a>
    </li>
    <li>
      <a title="The Source en EspaÃ±ol" href="http://elpasajero.metro.net">El Pasajero&mdash;Metro de Los Angeles</a>
    </li>
    <li>
      <a href="http://howweroll.trimet.org">How we Roll&mdash;Portland TriMet</a>
    </li>
    <li>
      <a target="_blank" title="BRT for Silicon Valley." href="http://valleyrapid.org">Valley Rapid&mdash;VTA BRT</a>
    </li>
  </ul>
</div>

<div class="barbox">
  <a href="/feed/feed.xml">New posts <img src="/img/feed.png" /></a>
</div>

        </div>
      </div>

      <div class="vspacer5"></div>

      <div class="row">
  <!-- force it center -->
  <div class="span1">&nbsp;</div>
  <div class="span10">
    <p class="center">
      <a href="/copyright">CC-BY-SA 3.0</a> by Matt Conway, 2011-2012. Created with
      Jekyll and Bootstrap.
    </p>
  </div>
</div>

    </div>
    <script src="/lib/bootstrap/js/bootstrap.min.js"></script>

  </body>
