<!DOCTYPE html>
<html>
  <head>
    <title>Home&mdash;Indicatrix</title>

    <link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css" />
<link rel="stylesheet" href="/css/pygments.css" />
<link rel="stylesheet" href="/css/main.css" />


  </head>
  <body>
    <div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand indicatrix" href="/">Indicatrix</a>
      <ul class="nav">
        <li><a href="/projects">Projects</a></li>
        <li><a href="/copyright">Copyright</a></li>
        <li><a href="/archive">Archive</a></li>
      </ul>
    </div>
  </div>
</div>


    <div class="container">
      <div class="hero-unit">
        <h1><a href="/"><img src="/img/header.jpg" alt="Indicatrix" /></a></h1>
        <div class="vspacer"></div>
        <p>A blog about mapping, Python, GIS, JavaScript, transit, open data,
          planning, &c.</p>
      </div>

      <div class="row">
        <div class="span9">
          
  
  <!-- link it b/c this template is used on the home page -->
<a href="/2011/06/19/qgis-1-7-wroclaw-released/">
  <h2>QGIS 1.7 'Wroc&#0322;aw' Released!</h2>
</a>
<p class="author">by mattwigway on June 19, 2011</p>

<p>It&rsquo;s official. QGIS 1.7 was released early this morning.</p>

<p>For the details, see the <a href="http://qgis.org/component/content/article/127-qgis-1-7-release.html">full press release</a>. Note also the new qgis.org banner, which appeared as I was writing this post.</p>

<p>1.7 is a major new release with a multitude of new features; see the above page for a list.</p>

<p>Many thanks to the QGIS team for all of their hard work.</p>


<!-- again, b/c it's used on the home page -->
<a href="/2011/06/19/qgis-1-7-wroclaw-released/">Permalink to this post</a>

  <div class="vspacer5"></div>

  
  <!-- link it b/c this template is used on the home page -->
<a href="/2011/05/29/archiving-historical-data-from-nextbus/">
  <h2>Archiving Historical Data from NextBus</h2>
</a>
<p class="author">by mattwigway on May 29, 2011</p>

<p>It seems that everyone who analyzes historical <a href="http://nextbus.com">NextBus</a> data has a different way of archiving their data. There are lots of ways one can use GIS to analyze this data, from creating movies showing the pulse of the transit system, to analyzing on-time performance, to finding bottlenecks. In that vein, I&rsquo;ve created a short Python script that fetches NextBus data and puts it into a <a href="http://postgis.org">PostGIS</a> database for analysis. You can download the latest version <a href="http://avl2postgis.googlecode.com/svn/trunk/avl2postgis.py">here</a>. Here&rsquo;s a rundown on options:</p>

<ul>
<li><p>-a, &mdash;agency: the agency. Default sf-muni. This must be the NextBus agency name, e.g. lametro, actransit, mbta.</p></li>
<li><p>-t, &mdash;table: the PostGIS table to store the retrieved data in. Default nextbus.</p></li>
<li><p>-d, &mdash;dsn: the DSN for your database; documented <a href="http://initd.org/psycopg/docs/module.html#psycopg2.connect">here</a>.</p></li>
<li><p>-i, &mdash;interval: the interval at which to make requests to the NextBus service. Note that this is <em>not </em>the resolution of the data; only updated locations are stored, so -i 30 grabs the latest location for every bus that has changed location, every 30 seconds (but see the all-vehicles option, below).</p></li>
<li><p>&mdash;all-vehicles: causes positions for all vehicles to be fetched on each request, rather than only updated positions.</p></li>
<li><p>&mdash;no-deltas: usually, the data is put in with the actual time of the update from the GPS unit to NextBus&rsquo;s server, but this causes the data to be put in with the timestamp of when it was retrieved. Used in conjunction with &mdash;all-vehicles, this provides a &lsquo;snapshot&rsquo; of the transit system every &lt;interval&gt; seconds.</p></li>
</ul>


<p>The table should look like this:</p>

<div class="highlight"><pre><code class="text">    
      Column   |         Type          |                       Modifiers            
    
    -----------+-----------------------+-------------------------------------------------------
     gid       | integer               | not null default nextval(&#39;nextbus_gid_seq&#39;::regclass)
     agency    | character varying     | not null
     vehicle   | character varying     | not null
     direction | character varying     | not null
     heading   | integer               | not null
     route     | character varying     | not null
     time      | character varying(19) | not null
     the_geom  | geometry              |
</code></pre>
</div>


<p>The SRID should be EPSG:4326 (WGS84). As far as I know, all NextBus agencies provide latlong in WGS84 or NAD83 (EPSG:4269), which are close enough to be interchangeable in this case.</p>

<p>The date field is formatted as YYYY-MM-DD HH:MM:SS, to be compatible with the QGIS <a href="http://www.geofrogger.net/trac/">Time Manager</a> plugin. The issue with the plugin is that buses tend to disappear (when the bus hasn&rsquo;t reported in the given time frame) or multiply (when the bus reported 2+ times).</p>

<p>For symbology, check out the new symbology implementatation in QGIS. Under Advanced-&gt;Rotation Field, you can choose the &lsquo;heading&rsquo; field to make your icons rotate to the correct orientation.</p>

<p>The one known issue with the script is that the interval is not respected; the way the interval is implemented is that, after one request has completed, the script sleeps for the interval period. So if requests average 3s, the interval between requests is actually ~33s.</p>

<p>Adding additional AVL services shouldn&rsquo;t be hard; if you&rsquo;re interested in tackling this, take a look at implementing a function that looks like getDataFromNextBus and drop me a line (contact link under the header); we can add it.</p>

<p>I&rsquo;ve licensed the code under the Apache License, version 2.0.</p>

<p>The requirements are pretty basic: you need Python, plus the pyquery library and psycopg2 libraries (both can be installed with easy_install).</p>


<!-- again, b/c it's used on the home page -->
<a href="/2011/05/29/archiving-historical-data-from-nextbus/">Permalink to this post</a>

  <div class="vspacer5"></div>

  
  <!-- link it b/c this template is used on the home page -->
<a href="/2011/05/29/changing-the-ownership-of-a-wordpress-blog/">
  <h2>Changing the Ownership of a WordPress Blog</h2>
</a>
<p class="author">by mattwigway on May 29, 2011</p>

<p>Astute readers will have noticed that the author of this blog has just changed. Not to worry, it&rsquo;s just an alter ego! I was doing some housekeeping to keep my various unrelated blogs straight as I move away from my other one. Here&rsquo;s how I did it:</p>

<p><em>By the way, it may be useful to use two separate browsers so that you can be signed into one WordPress account in each.</em></p>

<ol>
<li>Create a new WordPress account for the new blog owner by going to wordpress.com and clicking the orange &lsquo;Get started here&rsquo; button. If you don&rsquo;t want to create a new blog but just a username, click the infinitesimally small &lsquo;Sign up for just a username&rsquo; text under the username field. Fill out the fields (side note: if you only have one email address, and it&rsquo;s a Gmail address, you can trick WordPress.com into thinking you have a new email by adding a period to the address, e.g. if your address is johndoe@gmail.com, put in john.doe@gmail.com. You&rsquo;ll still get the emails at johndoe@gmail.com, but WordPress will think you have two emails.) If you already have the account you want to transfer the blog to, skip this step.</li>
<li>Click &lsquo;sign up.&rsquo;</li>
<li>In the original account (user A), go to the blog&rsquo;s dashboard, and choose &lsquo;Add New &ndash;&gt; User&rsquo; from the top bar. Enter the email address of the user you want to transfer the blog to (user B). If you used the period trick, enter the periods. Set &lsquo;Role&rsquo; to &lsquo;Administrator.&rsquo;</li>
<li>Click the confirmation link in the email that is sent to user B.</li>
<li>Go to the list of posts as user A. Click the first box to select all posts (I&rsquo;m not sure if this is an issue if you have more posts than fit on one page; comments welcome).</li>
<li>Under &lsquo;Bulk Actions&rsquo; choose &lsquo;Edit&rsquo;, then click &lsquo;Apply&rsquo;.</li>
<li>Change author from &emdash;No change&emdash; to the new administrator (this will make the new user the owner of all posts; if you have a multi-author blog, it&rsquo;ll take a little more doing and maybe some SQL trickery in the WordPress DB; as always, comments welcome). Click &lsquo;Apply&rsquo;.</li>
<li>If the author you are removing made any comments, you&rsquo;ll have to change the ownership manually. I just deleted my old comments and recommented as user B, but this will break threading on many blogs; perhaps there is another way that won&rsquo;t break threads. I had only made one comment anyhow.</li>
<li>As user A, go to <a href="https://dashboard.wordpress.com">https://dashboard.wordpress.com/</a> and click My Blogs on the left. Hover over the blog you are moving, and choose &lsquo;Transfer Blog.&rsquo; Check the box in the red warning. Enter user B&rsquo;s email (with the periods if applicable).</li>
<li>Open the confirm link in the email they send to user A. Make sure you do it in a browser where you are signed in as user A, not user B.</li>
<li>You&rsquo;re done!</li>
</ol>



<!-- again, b/c it's used on the home page -->
<a href="/2011/05/29/changing-the-ownership-of-a-wordpress-blog/">Permalink to this post</a>

  <div class="vspacer5"></div>

  
  <!-- link it b/c this template is used on the home page -->
<a href="/2011/05/28/installing-qgis-1-7-on-fedora/">
  <h2>Installing QGIS-1.7 on Fedora</h2>
</a>
<p class="author">by mattwigway on May 28, 2011</p>

<p>The <a href="http://www.qgis.org/wiki/Building_QGIS_from_Source#Building_QGIS_with_Qt_4.x">QGIS instructions</a> for building from source are targeted at Ubuntu, but they translate fairly well to Fedora. Here&rsquo;s a quick guide:</p>

<p>Instead of preparing apt as they say, use yum or Package Manager to install these packages:</p>

<ul>
<li>cmake</li>
<li>bison</li>
<li>flex</li>
<li>grass-devel</li>
<li>geos-devel</li>
<li>PyQt4-devel</li>
<li>gsl-devel</li>
<li>qwt-devel</li>
<li>gdal-devel</li>
</ul>


<p>There may be few that I already had installed on my system and missed; if you run configure below and find missing dependencies, run yum search &lt;whatever&gt; in a terminal to look for it. Make sure you install any relevant -devel packages as well.</p>

<p>Check qgis out of their SVN server into the directory of your choice; I chose qgis-May28 in my software build directory.</p>

<pre><code>svn co https://svn.osgeo.org/qgis/trunk/qgis qgis-May28
</code></pre>

<p>cd into that directory and create a directory called build. cd into that.</p>

<p>QGIS is configured using CMake. Since we&rsquo;re compiling a development version, we want to use a prefix (installation directory) other than the default, for instance ~/qgis-1.7. The .. signifies that the sources are in the directory above the build directory.</p>

<pre><code>CMAKE_BUILD_PREFIX=~/qgis-1.7 ccmake ..
</code></pre>

<p>Run through the menus, you can probably accept the defaults. Press &lsquo;c&rsquo; to configure QGIS. When that&rsquo;s done, press &lsquo;g&rsquo; to generate the Makefiles. Press &lsquo;q&rsquo; to quit if ccmake doesn&rsquo;t exit automatically.</p>

<p>Build qgis:</p>

<pre><code>make
</code></pre>

<p>Wait a while. When it&rsquo;s done, install qgis with:</p>

<pre><code>make install
</code></pre>

<p>You may need to become root if the directory you chose as a prefix isn&rsquo;t writable by a normal user.</p>

<p>I used Fedora 13 to write this post.</p>


<!-- again, b/c it's used on the home page -->
<a href="/2011/05/28/installing-qgis-1-7-on-fedora/">Permalink to this post</a>

  <div class="vspacer5"></div>

  
  <!-- link it b/c this template is used on the home page -->
<a href="/2011/05/25/1-2-3-mirror-modelling-in-inkscape/">
  <h2>1-2-3: Mirror Modelling in Inkscape</h2>
</a>
<p class="author">by mattwigway on May 25, 2011</p>

<p>The other day, I needed to draw a symmetrical object (a map point icon) in <a href="http://inkscape.org">Inkscape</a>, the wonderful free vector graphics editor. I was surprised to find that there is no symmetrical modeling feature, so I improvised. Here&rsquo;s how to create a symmetrical polygon in Inkscape:</p>

<ol>
<li>
Draw half of the object, using the line tool (I know you want a polygon, but draw one side of the object as a line). If you want something that is symmetrical both horizontally and vertically, draw one quarter of the object. I suggest using a guide, so that you can get the ends of the line to be vertically aligned (for vertical symmetry, i.e. left and right) or horizontally aligned (for horizontal symmetry). Get the shape right, because once you create the polygon, the sides will no longer automatically mirror each other.<br/>

<img src="/a/2011-05-25-1-2-3-mirror-modelling-in-inkscape/mirror1.png" />

</li>
<li>
Copy the line you just made and paste (ctrl-alt-v, Paste in Place, may make it easier to line up later, although it will be invisible when first pasted because it will align perfectly with the original path) it into the document. Choose Object-&gt;Flip Horizontal or Object-&gt;Flip Vertical, depending on the axis of symmetry. Move the flipped object so that the ends line up (i.e. it forms a polygon). You can use the arrow keys to align it; holding Alt while using the arrow keys makes them move the object finely. If you are doing two-axis symmetry, create 3 copies and flip one horizontally, one vertically, and one both vertically and horizontally, then line it all up.<br/>

<img src="/a/2011-05-25-1-2-3-mirror-modelling-in-inkscape/mirror2.png" />

</li>
<li>
Use the paint bucket tool to fill the area contained by the lines. This will create a polygon that is symmetrical. You can now either delete the polylines or move them to a hidden layer if you think you'll need them again.<br/>

<img src="/a/2011-05-25-1-2-3-mirror-modelling-in-inkscape/mirror3.png" />
</li>
</ol>





<!-- again, b/c it's used on the home page -->
<a href="/2011/05/25/1-2-3-mirror-modelling-in-inkscape/">Permalink to this post</a>

  <div class="vspacer5"></div>


<div class="paginator">
  
    
      <a href="/page4" class="previous">Newer Posts</a>
    
  

  
    <a href="/page6" class="next">Older Posts</a>
  
  <div class="clear"></div>
</div>

        </div>
        <div class="span3">
          <div class="barbox">
  <h3>Other Accounts</h3>
  <ul class="linklist">
    <li><a href="http://github.com/mattwigway">GitHub</a></li>
    <li><a href="http://twitter.com/mattwigway">Twitter</a></li>
  </ul>
</div>

<div class="barbox">
  <h3>Blogroll</h3>
  <ul class="linklist">
    <li>
      <a href="http://www.humantransit.org">Human Transit</a>
    </li>
    <li>
      <a title="Free and Open Source GIS" href="http://underdark.wordpress.com">UnderDark</a>
    </li>
    <li>
      <a href="http://transitappliance.org">Transit Appliance Development</a>
    </li>
    <li>
      <a href="http://portlandtransport.org">Portland Transport</a>
    </li>
    <li>
      <a href="http://thesource.metro.net">The Source&mdash;Los Angeles Metro</a>
    </li>
    <li>
      <a title="The Source en Español" href="http://elpasajero.metro.net">El Pasajero&mdash;Metro de Los Angeles</a>
    </li>
    <li>
      <a href="http://howweroll.trimet.org">How we Roll&mdash;Portland TriMet</a>
    </li>
    <li>
      <a target="_blank" title="BRT for Silicon Valley." href="http://valleyrapid.org">Valley Rapid&mdash;VTA BRT</a>
    </li>
  </ul>
</div>

<div class="barbox">
  <a href="/feed/feed.xml">New posts <img src="/img/feed.png" /></a>
</div>

        </div>
      </div>

      <div class="vspacer5"></div>

      <div class="row">
  <!-- force it center -->
  <div class="span1">&nbsp;</div>
  <div class="span10">
    <p class="center">
      <a href="/copyright">CC-BY-SA 3.0</a> by Matt Conway, 2011-2012. Created with
      Jekyll and Bootstrap.
    </p>
  </div>
</div>

    </div>
    <script src="/lib/bootstrap/js/bootstrap.min.js"></script>

  </body>
